CREATE DATABASE QLCHBANGIAY
USE [QLCHBANGIAY]
GO
CREATE TABLE DANHMUCSP
(
	MADMSP NVARCHAR(10) NOT NULL,
	TENDMSP NVARCHAR(50)
	CONSTRAINT PK_DANHMUCSP PRIMARY KEY(MADMSP)
)


CREATE TABLE LOAIGIAY
(
	MALOAI NVARCHAR(50) NOT NULL,
	TENLOAI NVARCHAR(50)
	CONSTRAINT PK_LOAIGIAY PRIMARY KEY(MALOAI)
)

CREATE TABLE NHACC
(
	MANCC NVARCHAR(50) PRIMARY KEY,
	TENNCC NVARCHAR(50),
	SDTNHACC NVARCHAR(50) ,
	EMAIL NVARCHAR(50),
	DIACHINCC NVARCHAR(50)
)

CREATE TABLE SANPHAM
(
	MASP NVARCHAR(50) NOT NULL,
	TENSP NVARCHAR(50),
	MADMSP NVARCHAR(10),
	MAU NVARCHAR(50),
	CHATLIEU NVARCHAR(50),
	GIA FLOAT,
	SOLUONGSIZE INT,
	TINHTRANGSP NVARCHAR(50),
	MALOAI NVARCHAR(50),
	MANCC NVARCHAR(50)
	CONSTRAINT PK_sp PRIMARY KEY(MASP)
)

ALTER TABLE SANPHAM
ADD FOREIGN KEY(MADMSP) REFERENCES DANHMUCSP(MADMSP)
ALTER TABLE SANPHAM
ADD FOREIGN KEY(MALOAI) REFERENCES LOAIGIAY(MALOAI)
ALTER TABLE SANPHAM
ADD FOREIGN KEY(MANCC) REFERENCES NHACC(MANCC)

CREATE TABLE KHO
(
	MASP NVARCHAR(50) NOT NULL,
	MADMSP NVARCHAR(10) NOT NULL,
	MALOAI NVARCHAR(50) NOT NULL,
	SOLUONG INT	,
	TRANGTHAI NVARCHAR(50),
	CONSTRAINT PK_KHO PRIMARY KEY(MASP, MADMSP, MALOAI)
)


ALTER TABLE KHO
ADD  FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)
ALTER TABLE KHO
ADD FOREIGN KEY(MADMSP) REFERENCES DANHMUCSP(MADMSP)
ALTER TABLE KHO
ADD FOREIGN KEY(MALOAI) REFERENCES LOAIGIAY(MALOAI)

CREATE TABLE SIZEGIAY
(
	MASP NVARCHAR(50) NOT NULL,
	SOSIZE INT NOT NULL,
	SOLUONGTON INT
	CONSTRAINT PK_SIZE PRIMARY KEY(MASP,SOSIZE)
)

ALTER TABLE SIZEGIAY
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)

CREATE TABLE CHUCVU
(
	MACHUCVU NVARCHAR(50) NOT NULL,
	TENCV NVARCHAR(50),
	LUONG FLOAT
	CONSTRAINT PK_CHUCVU PRIMARY KEY(MACHUCVU)
)


CREATE TABLE NHANVIEN
(
	MANV NVARCHAR(50) NOT NULL PRIMARY KEY,
	TENNV NVARCHAR(50),	
	GIOITINH NVARCHAR(5),
	SOCMND INT,
	DIENTHOAINV INT,
	DIACHI NVARCHAR(50),
	MACHUCVU NVARCHAR(50),
	TINHTRANG NVARCHAR(50),
	NGAYVAOLAM DATE,
	MANQL NVARCHAR(50),
	THUONGDOANHTHU FLOAT,
	LUONGTRU FLOAT,
	THUCLANH FLOAT
) 
ALTER TABLE NHANVIEN
ADD  FOREIGN KEY(MANQL) REFERENCES NHANVIEN(MANV)
ALTER TABLE NHANVIEN
ADD  FOREIGN KEY(MACHUCVU) REFERENCES CHUCVU(MACHUCVU)


/*
CREATE TABLE CALV
(
	MACA CHAR(10) NOT NULL PRIMARY KEY,
	TGCAVAO DATETIME,
	TGCARA DATETIME
)*/
/*CREATE TABLE NHANVIEN_TRUCCA
(
	MACA CHAR(10) NOT NULL,
	MANV CHAR(10) NOT NULL,
	NGAYLAMVIEC DATETIME
	CONSTRAINT PK_NV_TC PRIMARY KEY(MANV,MACA)
)*/

/*ALTER TABLE NHANVIEN_TRUCCA
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)*/
CREATE TABLE KHUYENMAI
(
	MAKM NVARCHAR(50) NOT NULL PRIMARY KEY,
	NOIDUNG NVARCHAR(50),
	PHANTRAM FLOAT,
	APDUNG BIT
)

CREATE TABLE CT_KHUYENMAI
(
	MAKM NVARCHAR(50) NOT NULL,
	MASP NVARCHAR(50) NOT NULL,
	NBD DATE,
	NKT DATE
	PRIMARY KEY (MAKM, MASP, NBD)
)
ALTER TABLE CT_KHUYENMAI
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)
ALTER TABLE CT_KHUYENMAI
ADD FOREIGN KEY(MAKM) REFERENCES KHUYENMAI(MAKM)


CREATE TABLE KHACHHANG
(
	MAKH NVARCHAR(50) PRIMARY KEY,
	TENKH NVARCHAR(50),
	SDTKHACHHANG INT,
	DIACHIKH NVARCHAR(50)
)

CREATE TABLE HOADONBAN
(
	MAHD NVARCHAR(50) NOT NULL PRIMARY KEY,
	NGAYLAP DATE,
	MANV NVARCHAR(50),
	TONGTIEN FLOAT,
	MAKHTT NVARCHAR(50),
	KHVANGLAI NVARCHAR(50),
	CHIECKHAU FLOAT
)
alter table HOADONBAN
ADD KHVANGLAI NVARCHAR(50)
	
ALTER TABLE HOADONBAN
ADD FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)
----------------------------
SELECT        CHITIETHOADONBAN.MACTHDB, CHITIETHOADONBAN.MAHD, CHITIETHOADONBAN.MASP, CHITIETHOADONBAN.MABH, CHITIETHOADONBAN.SOLUONGBAN, CHITIETHOADONBAN.DONGIABAN
FROM            PHIEUBAOHANH INNER JOIN
                         CHITIETHOADONBAN ON PHIEUBAOHANH.MABH = CHITIETHOADONBAN.MABH INNER JOIN
                         SIZEGIAY ON PHIEUBAOHANH.MASP = SIZEGIAY.MASP INNER JOIN
                         SANPHAM ON PHIEUBAOHANH.MASP = SANPHAM.MASP AND CHITIETHOADONBAN.MASP = SANPHAM.MASP AND SIZEGIAY.MASP = SANPHAM.MASP

---CREATE TABLE PHIEUBAOHANH
---(
---MASP CHAR(10) NOT NULL,
---MAKH CHAR(10) NOT NULL,
---THOIGIANBH INT,
	---TINHTRANG NVARCHAR(20),
	---MANV CHAR(10)
	---PRIMARY KEY (MASP,MAKH)
---)

CREATE TABLE PHIEUBAOHANH
(
	MABH NVARCHAR(50) PRIMARY KEY,
	MANV NVARCHAR(50),
	MAKH NVARCHAR(50),
	MASP NVARCHAR(50),
	NGAYHETHANDOITRA DATE,
)
ALTER TABLE PHIEUBAOHANH
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)
ALTER TABLE PHIEUBAOHANH
ADD FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)
ALTER TABLE PHIEUBAOHANH
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)

----------------------------------

CREATE TABLE CHITIETBAOHANH
(
	MABH NVARCHAR(50),
	MASP NVARCHAR(50),
	NGAYBAOHANH DATETIME,
	DKBAOHANH NVARCHAR(50),
	TINHTRANGBH NVARCHAR(50)
	PRIMARY KEY(MABH,DKBAOHANH)
)
ALTER TABLE CHITIETBAOHANH
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)
ALTER TABLE CHITIETBAOHANH
ADD FOREIGN KEY(MABH) REFERENCES PHIEUBAOHANH(MABH)


/*CREATE TABLE DKDOITRA
(
	MADK NVARCHAR(10) PRIMARY KEY,
	DKDOITRA NVARCHAR(50),
	MASP NVARCHAR(10),
	CHIPHIDOITRA FLOAT,
	THOIGIANDOITRA INT

)
ALTER TABLE DKDOITRA
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)*/

/*CREATE TABLE CHITIETHANGDOITRA
(	
	MADK CHAR(10),
	MASP CHAR(10),
	MAKH CHAR(10),
	MANV CHAR(10),
	NGAYDOITRA DATETIME
	PRIMARY KEY(MADK,MASP,MAKH)
)
ALTER TABLE CHITIETHANGDOITRA
ADD FOREIGN KEY(MADK) REFERENCES DKDOITRA(MADK)
ALTER TABLE CHITIETHANGDOITRA
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)
ALTER TABLE CHITIETHANGDOITRA
ADD FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)
ALTER TABLE CHITIETHANGDOITRA
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)*/


CREATE TABLE CHITIETHOADONBAN
(
	MACTHDB NVARCHAR(50) PRIMARY KEY,
	MAHD NVARCHAR(50) ,
	MASP NVARCHAR(50) ,
	MABH NVARCHAR(50),
	MAKM NVARCHAR(50),
	SOLUONGBAN INT,
	DONGIABAN FLOAT	
)

----ALTER TABLE CHITIETHOADONBAN
----ADD MACTHDB NVARCHAR(10)

-----ALTER TABLE CHITIETHOADONBAN
----ADD CONSTRAINT kc PRIMARY KEY (MACTHDB) 

---xoa khoa chinh cua cthd
---ALTER TABLE CHITIETHOADONBAN
---DROP CONSTRAINT kc;


ALTER TABLE CHITIETHOADONBAN
ADD FOREIGN KEY(MAKM) REFERENCES KHUYENMAI(MAKM)

ALTER TABLE CHITIETHOADONBAN
ADD FOREIGN KEY(MABH) REFERENCES PHIEUBAOHANH(MABH)

ALTER TABLE CHITIETHOADONBAN
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)

ALTER TABLE CHITIETHOADONBAN
ADD FOREIGN KEY(MAHD) REFERENCES HOADONBAN(MAHD)



CREATE TABLE QUANLYND
(
	TENDN NVARCHAR(50) NOT NULL PRIMARY KEY,
	MK NVARCHAR(50) NOT NULL,
	HOATDONG BIT,
)


ALTER TABLE QUANLYND
ADD FOREIGN KEY(TENDN) REFERENCES NHANVIEN(MANV)

CREATE TABLE QLNHOMND
(
	MANHOM NVARCHAR(50) NOT NULL PRIMARY KEY,
	TENNHOMND NVARCHAR(50) ,
	GHICHU NVARCHAR(50),
)

CREATE TABLE QLNDNHOMND
(	
	TENDN NVARCHAR(50) NOT NULL ,
	MANHOM NVARCHAR(50) NOT NULL ,
	GHICHU NVARCHAR(50),
	PRIMARY KEY(TENDN, MANHOM)
)
ALTER TABLE QLNDNHOMND
ADD FOREIGN KEY(TENDN) REFERENCES QUANLYND(TENDN)
ALTER TABLE QLNDNHOMND
ADD FOREIGN KEY(MANHOM) REFERENCES QLNHOMND(MANHOM)
---------------

-----------
CREATE TABLE DMMANHINH
(
	MAMANHINH NVARCHAR(20) NOT NULL PRIMARY KEY,
	TENMANHINHCHUCNANG NVARCHAR(50),
)

CREATE TABLE QLPHANQUYEN
(
	MANHOM NVARCHAR(50) NOT NULL,
	MAMANHINH NVARCHAR(20) NOT NULL,
	COQUYEN NVARCHAR(20) NOT NULL,
	PRIMARY KEY (MANHOM, MAMANHINH)
)

ALTER TABLE QLPHANQUYEN
ADD FOREIGN KEY(MANHOM) REFERENCES QLNHOMND(MANHOM)
ALTER TABLE QLPHANQUYEN
ADD FOREIGN KEY(MAMANHINH) REFERENCES DMMANHINH(MAMANHINH)

	
		

/*CREATE TABLE QUYEN
(
	MAQUYEN NVARCHAR(10) NOT NULL PRIMARY KEY,
	QUYEN NVARCHAR(20)
)*/

/*CREATE TABLE TAIKHOANNV
(
	TENTK NVARCHAR(20),
	MANV NVARCHAR(10),
	MATKHAU NVARCHAR(10),
	MAQUYEN NVARCHAR(10)
	PRIMARY KEY (TENTK)
)

ALTER TABLE TAIKHOANNV
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE TAIKHOANNV
ADD FOREIGN KEY(MAQUYEN) REFERENCES QUYEN(MAQUYEN)*/


/*CREATE TABLE NHOMQUYEN
(
	TENTK CHAR(20),
	MAQUYEN CHAR(10)
	PRIMARY KEY (TENTK, MAQUYEN)
)

ALTER TABLE NHOMQUYEN
ADD FOREIGN KEY(MAQUYEN) REFERENCES QUYEN(MAQUYEN)
ALTER TABLE NHOMQUYEN
ADD FOREIGN KEY(TENTK) REFERENCES TAIKHOANNV(TENTK)*/


CREATE TABLE PHIEUNHAP
(
	MAPN NVARCHAR(50) NOT NULL PRIMARY KEY,
	MANV NVARCHAR(50),
	MANCC NVARCHAR(50),
	NGAYNHAP DATE,
	TONGTIENNHAP FLOAT,
	
)


ALTER TABLE PHIEUNHAP
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE PHIEUNHAP
ADD FOREIGN KEY(MANCC) REFERENCES NHACC(MANCC)



CREATE TABLE CHITIETPHIEUNHAP
(
	MACTPN NVARCHAR(50) NOT NULL,
	MAPN NVARCHAR(50),
	MASP NVARCHAR(50),
	SOLUONGSP INT,
	GIATIEN FLOAT
	PRIMARY KEY(MACTPN)
)
ALTER TABLE CHITIETPHIEUNHAP
ADD FOREIGN KEY(MAPN) REFERENCES PHIEUNHAP(MAPN)
ALTER TABLE CHITIETPHIEUNHAP
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)

/*CREATE TABLE LUONG
(
	MALUONG CHAR(10) PRIMARY KEY,
	TONGCONG FLOAT,
	NGAYNHAN DATETIME
)

CREATE TABLE CTLUONG
(
	MALUONG CHAR(10) NOT NULL,
	MANV CHAR(10),
	LUONGDS FLOAT,
	THUONG FLOAT

	PRIMARY KEY (MALUONG, MANV)
)

ALTER TABLE CTLUONG
ADD FOREIGN KEY(MALUONG) REFERENCES LUONG(MALUONG)
ALTER TABLE CTLUONG
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)*/

/*CREATE TABLE THONGKE
(
	MASP NVARCHAR(10) ,
	MALOAI NVARCHAR(10),
	MADMSP NVARCHAR(10),
	NGAYTHONGKE DATETIME,
	TONGSPDB INT,
	TONGDOANHTHU FLOAT
	PRIMARY KEY(MASP, MALOAI, MADMSP,NGAYTHONGKE)

)
ALTER TABLE THONGKE
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)
ALTER TABLE THONGKE
ADD FOREIGN KEY(MALOAI) REFERENCES LOAIGIAY(MALOAI)
ALTER TABLE THONGKE
ADD FOREIGN KEY(MADMSP) REFERENCES DANHMUCSP(MADMSP)
CREATE TABLE CHITIETTHONGKE
(
	MANV NVARCHAR(10),
	MASP NVARCHAR(10),
	SOSIZE INT,
	GIAGOC FLOAT,
	GIABAN FLOAT,

)
ALTER TABLE CHITIETTHONGKE
ADD  FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE CHITIETTHONGKE
ADD  FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)*/

CREATE TABLE PHIEUDATHANGNCC
(
	SODONHANG NVARCHAR(50) PRIMARY KEY,
	MANCC NVARCHAR(50),
	MANV NVARCHAR(50),
	NGAYLAP DATETIME,
	TONGTIENNHAP FLOAT,
	TINHTRANGHANG NVARCHAR(50),
	SOTIENTRATRUOC FLOAT

)
ALTER TABLE PHIEUDATHANGNCC
ADD  FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE PHIEUDATHANGNCC
ADD  FOREIGN KEY(MANCC) REFERENCES NHACC(MANCC)



CREATE TABLE CTPHIEUDATHANGNCC
(
	SODONHANG NVARCHAR(50),
	MASP NVARCHAR(50),
	SOLUONG INT,
	DONGIA FLOAT
	PRIMARY KEY(SODONHANG,MASP)
)
ALTER TABLE CTPHIEUDATHANGNCC
ADD  FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)
ALTER TABLE CTPHIEUDATHANGNCC
ADD  FOREIGN KEY(SODONHANG) REFERENCES PHIEUDATHANGNCC(SODONHANG)

CREATE TABLE DONDATHANGKH
(
	MADH NVARCHAR(50) PRIMARY KEY,
	MAKH NVARCHAR(50),
	TONGSLSANPHAM INT,
	NGAYDAT DATE,
	TONGTIEN FLOAT
)

ALTER TABLE DONDATHANGKH
ADD FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)



CREATE TABLE CHITIETDDHKHACHHANG
(
	MADH NVARCHAR(50),
	MASP NVARCHAR(50),
	SOLUONGSP INT,
	GIATIEN FLOAT
	PRIMARY KEY (MADH, MASP),
)
ALTER TABLE CHITIETDDHKHACHHANG
ADD FOREIGN KEY(MADH) REFERENCES DONDATHANGKH(MADH)
ALTER TABLE CHITIETDDHKHACHHANG
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)


/*CREATE TABLE DANGNHAPNV
(
	MANV NVARCHAR(10),
	TENTAIKHOAN NVARCHAR(20),
	NGAYGIODN DATETIME,
	NGAYGIODANGXUAT DATETIME
	PRIMARY KEY (MANV, TENTAIKHOAN)
)

ALTER TABLE DANGNHAPNV
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE DANGNHAPNV
ADD FOREIGN KEY(TENTAIKHOAN) REFERENCES TAIKHOANNV(TENTK)*/

CREATE TABLE GIAOHANG
(
	MADH NVARCHAR(50) NOT NULL,
	MAHD NVARCHAR(50),
	MANVGIAOHANG NVARCHAR(50),
	NGAYGIOGIAOHANG DATETIME,
	PRIMARY KEY(MADH, MAHD, MANVGIAOHANG )
)
ALTER TABLE GIAOHANG
ADD FOREIGN KEY(MADH) REFERENCES DONDATHANGKH(MADH)
ALTER TABLE GIAOHANG
ADD FOREIGN KEY(MAHD) REFERENCES HOADONBAN(MAHD)
ALTER TABLE GIAOHANG
ADD FOREIGN KEY(MANVGIAOHANG) REFERENCES NHANVIEN(MANV)

ALTER TABLE GIAOHANG
ADD TINHTRANG NVARCHAR(20)
/*ALTER TABLE TAIKHOANNV
ADD NGAYLAPTK DATE*/
-----------------------

CREATE TABLE LICHSUGIA
(
	MASP NVARCHAR(50) NOT NULL,
	NGAYAPDUNG DATE NOT NULL,
	NGAYKETTHUC DATE,
	MUCGIA FLOAT,
	PRIMARY KEY(MASP, NGAYAPDUNG)
)

ALTER TABLE LICHSUGIA
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)

CREATE TABLE DMSUCO
(
	MASC NVARCHAR(50) NOT NULL PRIMARY KEY,
	TENSUCO NVARCHAR(50) ,
	SOTIEN MONEY,
)

CREATE TABLE BIENBANSUCO
(
	MABB NVARCHAR(50) NOT NULL PRIMARY KEY,
	MANV NVARCHAR(50) NOT NULL,
	GHICHU NVARCHAR(50) ,
	NGAYLAPBB DATE,
)

ALTER TABLE BIENBANSUCO
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)

CREATE TABLE CTBBSC
(
	MABB NVARCHAR(50) NOT NULL,
	MASC NVARCHAR(50) NOT NULL,
	THU_CHI MONEY,
	PRIMARY KEY(MABB, MASC),
)

ALTER TABLE CTBBSC
ADD FOREIGN KEY(MABB) REFERENCES BIENBANSUCO(MABB)
ALTER TABLE CTBBSC
ADD FOREIGN KEY(MASC) REFERENCES DMSUCO(MASC)

CREATE TABLE DMTK
(
	MADMTK NVARCHAR(50) NOT NULL PRIMARY KEY,
	LOAITHONGKE NVARCHAR (50),
)

CREATE TABLE THONGKE_SC
(
	MATKSC NVARCHAR(50) NOT NULL PRIMARY KEY,
	MANV NVARCHAR(50) NOT NULL,
	MADMTK NVARCHAR(50) NOT NULL,
	NGAYLAPTK DATETIME,
	TONGSOSC INT,
	TONGTHU_CHI MONEY,
)
ALTER TABLE THONGKE_SC
ADD FOREIGN KEY(MADMTK) REFERENCES DMTK(MADMTK)
ALTER TABLE THONGKE_SC
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
---------------

CREATE TABLE CTTKSC
(
	MATKSC NVARCHAR(50) NOT NULL, 
	MABB NVARCHAR(50) NOT NULL,
	THU_CHI MONEY,
	PRIMARY KEY (MATKSC, MABB)
)
ALTER TABLE CTTKSC
ADD FOREIGN KEY(MATKSC) REFERENCES THONGKE_SC(MATKSC)
ALTER TABLE CTTKSC
ADD FOREIGN KEY(MABB) REFERENCES BIENBANSUCO(MABB)


CREATE TABLE THONGKE_DS
(
	MATKDS NVARCHAR(50) NOT NULL PRIMARY KEY,
	MANV NVARCHAR(50) NOT NULL,
	MADMTK NVARCHAR(50) NOT NULL,
	NGAYLAPTK DATETIME,
	TONGSODS INT,
	TONGTIENDS MONEY,
)
ALTER TABLE THONGKE_DS
ADD FOREIGN KEY(MADMTK) REFERENCES DMTK(MADMTK)
ALTER TABLE THONGKE_DS
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)


CREATE TABLE CTTKDS
(
	MATKDS NVARCHAR(50) NOT NULL, 
	MASP NVARCHAR(50) NOT NULL,
	MALOAI NVARCHAR(50) NOT NULL,
	TIEN MONEY,
	PRIMARY KEY (MATKDS, MASP)
)
ALTER TABLE CTTKDS
ADD FOREIGN KEY(MATKDS) REFERENCES THONGKE_DS(MATKDS)
ALTER TABLE CTTKDS
ADD FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP)
ALTER TABLE CTTKDS
ADD FOREIGN KEY(MALOAI) REFERENCES LOAIGIAY(MALOAI)


CREATE TABLE THONGKE_CUOINAM
(
	MATKCN NVARCHAR(50) NOT NULL PRIMARY KEY,
	MANV NVARCHAR(50) NOT NULL,
	MADMTK NVARCHAR(50) NOT NULL,
	NGAYLAPTK DATETIME,
	TONGTIENDS_CN MONEY,
)
ALTER TABLE THONGKE_CUOINAM
ADD FOREIGN KEY(MADMTK) REFERENCES DMTK(MADMTK)
ALTER TABLE THONGKE_CUOINAM
ADD FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)


---RÀNG BUỘC DEFAULT---
ALTER TABLE NHANVIEN
ADD CONSTRAINT MACDINH_TT DEFAULT N'ĐANG LÀM' FOR TINHTRANG
ALTER TABLE NHANVIEN
ADD CONSTRAINT MACDINH_THUONGDOANHTHU DEFAULT (0) FOR THUONGDOANHTHU
ALTER TABLE NHANVIEN
ADD CONSTRAINT MACDINH_LUONGTRU DEFAULT (0) FOR LUONGTRU
ALTER TABLE NHANVIEN
ADD CONSTRAINT MACDINH_THUCLANH DEFAULT (0) FOR THUCLANH
ALTER TABLE NHANVIEN
ADD CONSTRAINT DF_NHANVIEN_NVL DEFAULT(CONVERT(DATE,GETDATE(),111)) FOR NGAYVAOLAM

ALTER TABLE CTBBSC
ADD CONSTRAINT CTBBSC_THU_CHI DEFAULT (0) FOR THU_CHI

ALTER TABLE BIENBANSUCO
ADD CONSTRAINT DF_NGAYLAPBB DEFAULT(CONVERT(DATE,GETDATE(),111)) FOR NGAYLAPBB

/*ALTER TABLE TAIKHOANNV
ADD CONSTRAINT DF_TAIKHOAN DEFAULT('123456789') FOR MATKHAU
ALTER TABLE TAIKHOANNV
ADD CONSTRAINT DF_TAIKHOAN_1 DEFAULT(CONVERT(DATE,GETDATE(),111)) FOR NGAYLAPTK*/

ALTER TABLE PHIEUNHAP
ADD CONSTRAINT DF_NGAYNHAP DEFAULT(CONVERT(DATE,GETDATE(),120)) FOR NGAYNHAP
ALTER TABLE PHIEUNHAP
ADD CONSTRAINT DF_TONGTIEN_NHAP DEFAULT(0) FOR TONGTIENNHAP

ALTER TABLE CHITIETPHIEUNHAP
ADD CONSTRAINT DF_SOLUINGSP DEFAULT(0) FOR SOLUONGSP
ALTER TABLE CHITIETPHIEUNHAP
ADD CONSTRAINT DF_GIATIEN DEFAULT(0) FOR GIATIEN

ALTER TABLE HOADONBAN
ADD CONSTRAINT DF_NGAYLAP DEFAULT(CONVERT(DATE,GETDATE(),120)) FOR NGAYLAP
ALTER TABLE HOADONBAN
ADD CONSTRAINT DF_TONGTIEN_BAN DEFAULT(0) FOR TONGTIEN

ALTER TABLE CHITIETHOADONBAN
ADD CONSTRAINT DF_SOLUONGBAN DEFAULT(0) FOR SOLUONGBAN
ALTER TABLE CHITIETHOADONBAN
ADD CONSTRAINT DF_DONGIABAN DEFAULT(0) FOR DONGIABAN

ALTER TABLE GIAOHANG
ADD CONSTRAINT DF_NGAYGIAO DEFAULT(CONVERT(DATE,GETDATE(),120)) FOR NGAYGIOGIAOHANG

ALTER TABLE DONDATHANGKH
ADD CONSTRAINT DF_NGAYDAT DEFAULT(CONVERT(DATE,GETDATE(),111)) FOR NGAYDAT
ALTER TABLE DONDATHANGKH
ADD CONSTRAINT DF_TONGTIEN DEFAULT(0) FOR TONGTIEN
ALTER TABLE DONDATHANGKH
ADD CONSTRAINT DF_TONGSLSP DEFAULT(0) FOR TONGSLSANPHAM

ALTER TABLE CHITIETDDHKHACHHANG
ADD CONSTRAINT DF_SOLUONGSP DEFAULT(0) FOR SOLUONGSP
ALTER TABLE CHITIETDDHKHACHHANG
ADD CONSTRAINT DF_GT DEFAULT(0) FOR GIATIEN

ALTER TABLE KHO
ADD CONSTRAINT DF_SOLUONG DEFAULT(0) FOR SOLUONG

ALTER TABLE SIZEGIAY
ADD CONSTRAINT DF_SOLUONGTON DEFAULT(0) FOR SOLUONGTON

ALTER TABLE SANPHAM
ADD CONSTRAINT DF_SOLUONGSIZE DEFAULT(0) FOR SOLUONGSIZE
ALTER TABLE SANPHAM
ADD CONSTRAINT DF_GIA DEFAULT(0) FOR GIA

ALTER TABLE CHITIETBAOHANH
ADD CONSTRAINT DF_NGAYBH DEFAULT(CONVERT(DATE,GETDATE(),120)) FOR NGAYBAOHANH



---TRIGGER---
--RANG BUOC TONG TIEN HOA DON BAN TRONG HOA DON KO DC PHEP AM

CREATE TRIGGER RANGBUOC_TONGTIEN_HDBAN
ON HOADONBAN
FOR INSERT, UPDATE
AS
	BEGIN
	IF(SELECT TONGTIEN FROM INSERTED)<0
		BEGIN
			PRINT N'TỔNG TIỀN PHẢI LỚN HƠN 0'
			ROLLBACK TRAN
		END
	END
GO
--RANG BUOC TONG TIEN HOA DON NHAP TRONG HOA DON KO DC PHEP AM

CREATE TRIGGER RANGBUOC_TONGTIEN_HDNHAP
ON PHIEUNHAP
FOR INSERT, UPDATE
AS
	BEGIN
	IF(SELECT TONGTIENNHAP FROM INSERTED)<0
		BEGIN
			PRINT N'TỔNG TIỀN KHÔNG ĐƯỢC NHỎ HƠN 0'
			ROLLBACK TRAN
		END
	END
GO
--TU THEM DON GIA TRONG CHITIETHDBAN XUAT KHI NHAP MA SACH

CREATE TRIGGER THEMGIAVAOCTHD_BAN
ON CHITIETHOADONBAN
FOR INSERT
AS
	DECLARE @DG MONEY
	SET @DG=(SELECT GIA FROM INSERTED, SANPHAM WHERE INSERTED.MASP=SANPHAM.MASP)
	UPDATE CHITIETHOADONBAN
	SET DONGIABAN=@DG
	WHERE CHITIETHOADONBAN.MAHD=(SELECT MAHD FROM INSERTED) AND CHITIETHOADONBAN.MASP=(SELECT MASP FROM INSERTED)
GO

--GIAM SO LUONG SAN PHAM

CREATE TRIGGER GIAMSLSANPHAM
ON CHITIETHOADONBAN
FOR INSERT
AS
	BEGIN
		IF(SELECT KHO.SOLUONG FROM KHO, INSERTED WHERE INSERTED.MASP=KHO.MASP)=0
		BEGIN
			PRINT'HET HANG'
			ROLLBACK TRAN
		END
		ELSE
		BEGIN
			IF(SELECT SOLUONGBAN FROM INSERTED)>(SELECT KHO.SOLUONG FROM KHO, INSERTED WHERE INSERTED.MASP=KHO.MASP)
			BEGIN
				PRINT N'KHONG DU HANG BAN'
				ROLLBACK TRAN
			END
			ELSE
			BEGIN
			UPDATE KHO
			SET SOLUONG=SOLUONG-(SELECT SOLUONGBAN FROM INSERTED)
			WHERE KHO.MASP=(SELECT MASP FROM INSERTED)
			END
		END
	END

--TANG SO LUONG SAN PHAM
Create TRIGGER TANGSLSP
ON CHITIETPHIEUNHAP
FOR INSERT, update, delete
AS
	BEGIN
		UPDATE KHO
		SET SOLUONG=SOLUONG+(SELECT SOLUONGSP FROM INSERTED)
		WHERE KHO.MASP=(SELECT MASP FROM INSERTED)
	END
GO

--TINH TONG TIEN HOA DON BAN

CREATE TRIGGER TT_HD_BAN
ON CHITIETHOADONBAN
FOR INSERT
AS
	BEGIN
		UPDATE HOADONBAN
		SET TONGTIEN=(TONGTIEN+(SELECT SUM(SOLUONGBAN*DONGIABAN) FROM INSERTED WHERE INSERTED.MAHD=HOADONBAN.MAHD))-((TONGTIEN+(SELECT SUM(SOLUONGBAN*DONGIABAN) FROM INSERTED WHERE INSERTED.MAHD=HOADONBAN.MAHD))*CHIECKHAU/100)
		WHERE HOADONBAN.MAHD=(SELECT MAHD FROM INSERTED)
	END
GO

--TINH TONG TIEN HOA DON NHAP
CREATE TRIGGER TT_HD_NHAP
ON CHITIETPHIEUNHAP
FOR INSERT, UPDATE,DELETE
AS
	BEGIN
		UPDATE PHIEUNHAP
		SET TONGTIENNHAP=TONGTIENNHAP+(SELECT SUM(SOLUONGSP*GIATIEN) FROM INSERTED WHERE PHIEUNHAP.MAPN=INSERTED.MAPN)
		WHERE PHIEUNHAP.MAPN=(SELECT MAPN FROM INSERTED)
	END
GO
-------
-------
---Tính tổng tiền Đơn đặt hàng khách hàng
CREATE TRIGGER TT_DDHANGKH
ON CHITIETDDHKHACHHANG
FOR INSERT
AS
	BEGIN 
		UPDATE DONDATHANGKH
		SET TONGTIEN=TONGTIEN+(SELECT Sum(inserted.SOLUONGSP*inserted.GIATIEN) FROM  inserted WHERE DONDATHANGKH.MADH=inserted.MADH) 
		where DONDATHANGKH.MADH=(select inserted.MADH from inserted)
	end
go

--TAO NHAN VIEN TU DONG THEM TAI KHOAN

CREATE TRIGGER NV_TK
ON NHANVIEN
FOR INSERT, DELETE
AS
	BEGIN
		INSERT INTO QUANLYND(TENDN,MK,HOATDONG)
			SELECT TENDN=INSERTED.MANV, MK='123456789', HOATDONG=0 FROM INSERTED
		DELETE QLNDNHOMND
		WHERE QLNDNHOMND.TENDN=(SELECT MANV FROM DELETED)
		DELETE QUANLYND
		WHERE QUANLYND.TENDN=(SELECT MANV FROM DELETED)
	END

--SO LUONG MUA SACH TRONG CHI TIET HOA DON BAN LON HON 0

CREATE TRIGGER CTHD_BAN
ON CHITIETHOADONBAN
FOR INSERT, UPDATE, DELETE
AS
	BEGIN
	IF(SELECT INSERTED.SOLUONGBAN FROM INSERTED)<0
		BEGIN
			PRINT N'SỐ LƯỢNG SÁCH PHẢI LỚN HƠN 0'
			ROLLBACK TRAN
		END
END

--SO LUONG NHAP SACH TRONG CHI TIET HOA DON NHAP LON HON 0

CREATE TRIGGER CTHD_SACH_NHAP
ON CHITIETPHIEUNHAP
FOR INSERT, UPDATE, DELETE
AS
	BEGIN
	IF(SELECT INSERTED.SOLUONGSP FROM INSERTED)<0
		BEGIN
			PRINT N'SỐ LƯỢNG PHẢI LỚN HƠN 0'
			ROLLBACK TRAN
		END
	END

--TINH THUC LANH BANG NHAN VIEN
CREATE TRIGGER NHANVIEN_THUCLANH
ON NHANVIEN
FOR INSERT, UPDATE, DELETE
AS
	BEGIN
		UPDATE NHANVIEN
		SET THUCLANH=THUONGDOANHTHU+LUONGTRU+(SELECT LUONG FROM CHUCVU WHERE CHUCVU.MACHUCVU=NHANVIEN.MACHUCVU )
		WHERE NHANVIEN.MANV=(SELECT MANV FROM INSERTED)
	END

--TINH THUC LANH KHI THAY DOI LUONG TRONG BANG CHUCVU
CREATE TRIGGER CHUCVU_NHANVIEN_THUCLANH
ON CHUCVU
FOR UPDATE, DELETE
AS
	BEGIN
		IF EXISTS(SELECT * FROM NHANVIEN, INSERTED WHERE NHANVIEN.MACHUCVU=INSERTED.MACHUCVU)
		BEGIN
			UPDATE NHANVIEN
			SET THUCLANH=THUONGDOANHTHU+LUONGTRU+(SELECT LUONG FROM CHUCVU WHERE CHUCVU.MACHUCVU=NHANVIEN.MACHUCVU )
			WHERE NHANVIEN.MANV=(SELECT MANV FROM INSERTED)
		END
	END

--LƯU LỊCH SỬ GIÁ BÁN
CREATE TRIGGER LICHSUGIA_SANPHAM
ON SANPHAM
FOR INSERT, DELETE
AS
	BEGIN
		INSERT INTO LICHSUGIA(MASP,NGAYAPDUNG,MUCGIA)
			SELECT MASP=INSERTED.MASP,NGAYAPDUNG=(CONVERT(DATE,GETDATE(),120)) ,MUCGIA=INSERTED.GIA FROM INSERTED
		DELETE LICHSUGIA
		WHERE MASP=(SELECT MASP FROM DELETED)
	END


---FUNCTION---
--TAO MA HOA DON NHAP TU DONG

CREATE FUNCTION SINHMA_HDN()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MHD NVARCHAR(100)
	SET @MHD='HDN'+CONVERT(NVARCHAR(10),MONTH(GETDATE()))+CONVERT(NVARCHAR(10),DAY(GETDATE()))+REPLACE(((CONVERT(NVARCHAR(10),(GETDATE()),108))),':','')
	RETURN @MHD
END


--TAO MA KHUYEN MAI TU DONG

CREATE FUNCTION SINHMA_KM()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MHD NVARCHAR(100)
	SET @MHD='MAKM'+CONVERT(NVARCHAR(10),MONTH(GETDATE()))+CONVERT(NVARCHAR(10),DAY(GETDATE()))+REPLACE(((CONVERT(NVARCHAR(10),(GETDATE()),108))),':','')
	RETURN @MHD
END

--TAO MA CT HOA DON BAN TU DONG

CREATE FUNCTION SINHMA_CTHDB()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MHD NVARCHAR(100)
	SET @MHD='CTHDX'+CONVERT(NVARCHAR(10),MONTH(GETDATE()))+CONVERT(NVARCHAR(10),DAY(GETDATE()))+REPLACE(((CONVERT(NVARCHAR(10),(GETDATE()),108))),':','')
	RETURN @MHD
END

--TAO MA HOA DON BAN TU DONG

CREATE FUNCTION SINHMA_HDB()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MHD NVARCHAR(100)
	SET @MHD='HDX'+CONVERT(NVARCHAR(10),MONTH(GETDATE()))+CONVERT(NVARCHAR(10),DAY(GETDATE()))+REPLACE(((CONVERT(NVARCHAR(10),(GETDATE()),108))),':','')
	RETURN @MHD
END

--TAO MA DAT HANG NHA CUNG CAP TU DONG

CREATE FUNCTION SINHMA_DH_NCC()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MHD NVARCHAR(100)
	SET @MHD='SDH'+CONVERT(NVARCHAR(10),MONTH(GETDATE()))+CONVERT(NVARCHAR(10),DAY(GETDATE()))+REPLACE(((CONVERT(NVARCHAR(10),(GETDATE()),108))),':','')
	RETURN @MHD
END

--TAO MA DOI TRA HANG TU DONG

CREATE FUNCTION SINHMA_DOITRA()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MHD NVARCHAR(100)
	SET @MHD='DT'+CONVERT(NVARCHAR(10),MONTH(GETDATE()))+CONVERT(NVARCHAR(10),DAY(GETDATE()))+REPLACE(((CONVERT(NVARCHAR(10),(GETDATE()),108))),':','')
	RETURN @MHD
END

DECLARE @MHD NVARCHAR(100)
set @MHD=dbo.SINHMA_DOITRA()
print @MHD

SELECT REPLACE(((CONVERT(NVARCHAR(10),(GETDATE()),108))),':','')

--TAO MA KHACH HANG TU DONG

CREATE FUNCTION SINHMA_KH()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MKH NVARCHAR(100)
	SET @MKH='KH'+CONVERT(NVARCHAR(10),GETDATE(),112)+REPLACE(((CONVERT(NVARCHAR(10),(GETDATE()),108))),':','')
	RETURN @MKH
END

DECLARE @MHD NVARCHAR(100)
set @MHD=dbo.SINHMA_KH()
print @MHD

--TAO MA PHIEU BAO HANH

CREATE FUNCTION SINHMA_PBH()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MKH NVARCHAR(100)
	SET @MKH='BH0'+CONVERT(NVARCHAR(10),(SELECT COUNT(*)+1 FROM PHIEUBAOHANH))
	RETURN @MKH
END
DECLARE @MHD NVARCHAR(100)
set @MHD=dbo.SINHMA_PBH()
print @MHD

---sinh mã đơn đặt hàng


CREATE FUNCTION SINHMA_PDHNCC()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MKH NVARCHAR(100)
	SET @MKH='DH'+CONVERT(NVARCHAR(10),(SELECT COUNT(*)+1 FROM PHIEUDATHANGNCC))
	RETURN @MKH
END
--SINH MA BIEN BAN SU CO

CREATE FUNCTION SINHMA_BBSC()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MKH NVARCHAR(100)
	SET @MKH='BB'+CONVERT(NVARCHAR(10),(SELECT COUNT(*)+1 FROM BIENBANSUCO))
	RETURN @MKH
END

DECLARE @MHD NVARCHAR(100)
set @MHD=dbo.SINHMA_BBSC()
print @MHD
--TAO MA NV


CREATE FUNCTION SINHMA_NV()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MNV NVARCHAR(100)
	SET @MNV='NV0'+CONVERT(NVARCHAR(10),(SELECT COUNT(*)+1 FROM NHANVIEN))
	RETURN @MNV
END
DECLARE @MHD NVARCHAR(100)
set @MHD=dbo.SINHMA_NV()
print @MHD


----Sinh mã danh mục sản phẩm
create FUNCTION SINHMA_DMSP()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MNV NVARCHAR(100)
	SET @MNV='DM0'+ CONVERT(NVARCHAR(10),(SELECT COUNT(*)+1 FROM DANHMUCSP))
	RETURN @MNV
END

DECLARE @MHD NVARCHAR(100)
set @MHD=dbo.SINHMA_DMSP()
print @MHD
---Sinh mã khách hàng
create FUNCTION SINHMA_Khachhang()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MNV NVARCHAR(100)
	SET @MNV='KH0'+ CONVERT(NVARCHAR(10),(SELECT COUNT(*)+1 FROM KHACHHANG))
	RETURN @MNV
END

DECLARE @MHD NVARCHAR(100)
set @MHD=dbo.SINHMA_Khachhang()
print @MHD
--TAO MA Thongke

CREATE FUNCTION SINHMA_TK()
RETURNS NVARCHAR(30)
AS
	BEGIN
	DECLARE @MKH NVARCHAR(100)
	SET @MKH='TK'+CONVERT(NVARCHAR(10),MONTH(GETDATE()))+CONVERT(NVARCHAR(10),DAY(GETDATE()))+REPLACE(((CONVERT(NVARCHAR(10),(GETDATE()),108))),':','')
	RETURN @MKH
END
--GIAY BAN DC NHIEU NHAT

CREATE FUNCTION XEM_GIAYBANNHIEUNHAT()
RETURNS TABLE
AS
	RETURN (SELECT SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI ,SUM(CHITIETHOADONBAN.SOLUONGBAN) AS 'TONG' FROM CHITIETHOADONBAN, SANPHAM, LOAIGIAY 
				WHERE SANPHAM.MASP=CHITIETHOADONBAN.MASP AND SANPHAM.MALOAI=LOAIGIAY.MALOAI
				GROUP BY SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI
				HAVING SUM(CHITIETHOADONBAN.SOLUONGBAN)>= ALL(SELECT SUM(SOLUONGBAN) FROM CHITIETHOADONBAN GROUP BY CHITIETHOADONBAN.MASP) )
GO


--GIAY NHAP NHIEU NHAT

CREATE FUNCTION XEM_GIAYNHAPNHIEUNHAT()
RETURNS TABLE
AS
	RETURN (SELECT SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI ,SUM(CHITIETPHIEUNHAP.SOLUONGSP) AS 'TONG' FROM CHITIETPHIEUNHAP, SANPHAM, LOAIGIAY 
				WHERE SANPHAM.MASP=CHITIETPHIEUNHAP.MASP AND SANPHAM.MALOAI=LOAIGIAY.MALOAI
				GROUP BY SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI
				HAVING SUM(CHITIETPHIEUNHAP.SOLUONGSP)>= ALL(SELECT SUM(SOLUONGSP) FROM CHITIETPHIEUNHAP GROUP BY CHITIETPHIEUNHAP.MASP))
GO

--XEM SO GIAY DA BAN THEO MA HOA DON BAN


CREATE FUNCTION XEM_GIAY_HDB(@MHDB NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI, CHITIETHOADONBAN.DONGIABAN, SUM(CHITIETHOADONBAN.SOLUONGBAN) AS 'SO GIAY BAN', HOADONBAN.NGAYLAP  FROM CHITIETHOADONBAN,SANPHAM,HOADONBAN, LOAIGIAY WHERE SANPHAM.MASP=CHITIETHOADONBAN.MASP AND SANPHAM.MALOAI=LOAIGIAY.MALOAI AND CHITIETHOADONBAN.MAHD=HOADONBAN.MAHD AND CHITIETHOADONBAN.MAHD LIKE '%'+@MHDB+'%'
			GROUP BY SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI, CHITIETHOADONBAN.DONGIABAN,HOADONBAN.NGAYLAP)
GO



--XEM SO GIAY DA NHAP THEO MA PHIEU NHAP


CREATE FUNCTION XEM_GIAY_HDN(@MHDN NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI, CHITIETPHIEUNHAP.GIATIEN, SUM(CHITIETPHIEUNHAP.SOLUONGSP) AS 'SO GIAY NHAP', PHIEUNHAP.NGAYNHAP  FROM CHITIETPHIEUNHAP,SANPHAM,LOAIGIAY,PHIEUNHAP WHERE SANPHAM.MASP=CHITIETPHIEUNHAP.MASP AND CHITIETPHIEUNHAP.MAPN=PHIEUNHAP.MAPN AND SANPHAM.MALOAI=LOAIGIAY.MALOAI AND CHITIETPHIEUNHAP.MAPN LIKE '%'+@MHDN+'%'
			GROUP BY SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI, CHITIETPHIEUNHAP.GIATIEN,  PHIEUNHAP.NGAYNHAP)
GO



--XEM GIAY TON TRONG KHO THEO MA GIAY


CREATE FUNCTION XEM_SACH_TRONGKHO_THEOMA(@MS NVARCHAR(20))
RETURNS TABLE
AS
	RETURN (SELECT SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, SOLUONG FROM SANPHAM, KHO WHERE SANPHAM.MASP=KHO.MASP AND SANPHAM.MASP LIKE '%'+@MS+'%')
GO


--TRUY XUAT KHACH HANG THEO THONG TIN TRUYEN VAO


CREATE FUNCTION INTHONGTINKH(@MKH NVARCHAR(20),@TENKH NVARCHAR(50),@SDT NVARCHAR(20),@DC NVARCHAR(50))
RETURNS TABLE
AS
	RETURN (SELECT * FROM KHACHHANG WHERE KHACHHANG.MAKH LIKE '%'+@MKH+'%' AND KHACHHANG.TENKH LIKE '%'+@TENKH+'%' AND KHACHHANG.SDTKHACHHANG LIKE '%'+@SDT+'%' AND KHACHHANG.DIACHIKH LIKE '%'+@DC+'%' )
GO


-- IN CAC GIAY BAN THEO NGAY TRUYEN DU LIEU NGAY


CREATE FUNCTION XEM_GIAY_HDB_NL(@NGAYLAP DATE)
RETURNS TABLE
AS
	RETURN (SELECT SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI, CHITIETHOADONBAN.DONGIABAN, SUM(CHITIETHOADONBAN.SOLUONGBAN) AS 'TONG'  FROM CHITIETHOADONBAN,SANPHAM,HOADONBAN,LOAIGIAY WHERE SANPHAM.MASP=CHITIETHOADONBAN.MASP AND CHITIETHOADONBAN.MAHD=HOADONBAN.MAHD
			AND SANPHAM.MALOAI=LOAIGIAY.MALOAI AND HOADONBAN.NGAYLAP=@NGAYLAP GROUP BY SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI, CHITIETHOADONBAN.DONGIABAN)
GO


-- IN CAC GIAY NHAP THEO NGAY


CREATE FUNCTION XEM_GIAY_HDN_NN(@NGAYNHAP DATE)
RETURNS TABLE
AS
	RETURN (SELECT SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI, CHITIETPHIEUNHAP.GIATIEN, SUM(CHITIETPHIEUNHAP.SOLUONGSP) AS 'TONG'  FROM CHITIETPHIEUNHAP,SANPHAM,PHIEUNHAP,LOAIGIAY WHERE SANPHAM.MASP=CHITIETPHIEUNHAP.MASP AND CHITIETPHIEUNHAP.MAPN=PHIEUNHAP.MAPN
			AND SANPHAM.MALOAI=LOAIGIAY.MALOAI AND PHIEUNHAP.NGAYNHAP=@NGAYNHAP GROUP BY SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, LOAIGIAY.TENLOAI, CHITIETPHIEUNHAP.GIATIEN)
GO

--IN DS GIAY THEO TEN GIAY


CREATE FUNCTION DSGIAT_TENSP (@TSP NVARCHAR(50))
RETURNS TABLE
AS
	RETURN (SELECT * FROM SANPHAM WHERE TENSP LIKE '%'+@TSP+'%')
GO



--IN DS GIAY THEO TENSP VA NCC


CREATE FUNCTION DSGIAY_SP_NCC (@TSP NVARCHAR(50), @NCC NVARCHAR(50))
RETURNS TABLE
AS
	RETURN (SELECT SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, SANPHAM.CHATLIEU, SANPHAM.GIA, KHO.SOLUONG, NHACC.TENNCC FROM SANPHAM, NHACC, KHO WHERE TENSP LIKE '%'+@TSP+'%' AND NHACC.TENNCC LIKE '%'+@NCC+'%' AND SANPHAM.MANCC=NHACC.MANCC AND SANPHAM.MASP=KHO.MASP)
GO

-- IN DS GIAY THEO TENNCC


CREATE FUNCTION DSGIAY_NHACC (@NCC NVARCHAR(100))
RETURNS TABLE
AS
	RETURN (SELECT SANPHAM.MASP, SANPHAM.TENSP, SANPHAM.MAU, SANPHAM.CHATLIEU, SANPHAM.GIA, KHO.SOLUONG FROM SANPHAM, NHACC, KHO WHERE TENNCC LIKE '%'+@NCC+'%' AND NHACC.MANCC=SANPHAM.MANCC AND SANPHAM.MASP=KHO.MASP)
GO

--IN THÔNG TIN PBH THEO MA BAO HANH


CREATE FUNCTION XEMTT_PBH(@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM PHIEUBAOHANH WHERE PHIEUBAOHANH.MABH LIKE '%'+@TLG+'%')
GO


--IN THÔNG TIN GIAY THEO TENLOAIGIAY


CREATE FUNCTION XEMTT_LG_TLG(@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM LOAIGIAY WHERE LOAIGIAY.TENLOAI LIKE '%'+@TLG+'%')
GO

--tìm nhóm người dùng
CREATE FUNCTION XEM_NHOMND(@TENKH NVARCHAR(50))
	RETURNS TABLE
	AS
	RETURN(SELECT * FROM QLNHOMND WHERE TENNHOMND  LIKE '%'+@TENKH+'%')

--TÌM KH DỰA VÀO TÊN KH


CREATE FUNCTION XEM_TENKH(@TENKH NVARCHAR(50))
	RETURNS TABLE
	AS
	RETURN(SELECT * FROM KHACHHANG WHERE TENKH LIKE '%'+@TENKH+'%')


--XUAT THONG TIN NHAN VIEN THEO TENNV


CREATE FUNCTION XEMTT_NV_TNV(@TNV NVARCHAR(50))
RETURNS TABLE
AS
	RETURN (SELECT * FROM NHANVIEN WHERE TENNV LIKE '%'+@TNV+'%')
GO


--XUAT THONG TIN NHAN VIEN THEO MANV


CREATE FUNCTION XEMTT_NV(@MNV NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM NHANVIEN WHERE NHANVIEN.MANV LIKE '%'+@MNV+'%')
GO



--XUAT TEN NHAN VIEN THEO MANV


CREATE FUNCTION XEM_TENNV(@MNV NVARCHAR(10))
RETURNS NVARCHAR(50)
AS
	BEGIN
		DECLARE @HT NVARCHAR(50)
		SET @HT=(SELECT TENNV FROM NHANVIEN WHERE MANV LIKE '%'+@MNV+'%')
		RETURN @HT
END

--tinh doanh so




CREATE FUNCTION tongdoanhso(@NBD DATE, @NKT DATE)
RETURNS NVARCHAR(50)
AS
	BEGIN
		DECLARE @HT INT
		SET @HT=(SELECT SUM(SOLUONGBAN) FROM HOADONBAN,CHITIETHOADONBAN WHERE HOADONBAN.MAHD=CHITIETHOADONBAN.MAHD AND HOADONBAN.NGAYLAP BETWEEN CONVERT(DATE,@NBD,111) AND CONVERT(DATE,@NKT,111))
		RETURN @HT
END

--tinh doanh thu

CREATE FUNCTION tongdoanhthu(@NBD DATE, @NKT DATE)
RETURNS NVARCHAR(50)
AS
	BEGIN
		DECLARE @HT money
		SET @HT=(SELECT SUM(TONGTIEN) FROM HOADONBAN,CHITIETHOADONBAN WHERE HOADONBAN.NGAYLAP BETWEEN @NBD AND @NKT)
		RETURN @HT
END
--tien cttkds
CREATE FUNCTION tiencttkds(@MSP NVARCHAR(50),@NBD DATE, @NKT DATE)
RETURNS NVARCHAR(50)
AS
	BEGIN
		DECLARE @HT MONEY
		SET @HT=(SELECT SUM(SOLUONGBAN*DONGIABAN) FROM CHITIETHOADONBAN,HOADONBAN WHERE CHITIETHOADONBAN.MAHD=HOADONBAN.MAHD and CHITIETHOADONBAN.MASP=@MSP and HOADONBAN.NGAYLAP BETWEEN CONVERT(date,@NBD,111) AND CONVERT(date,@NKT,111))
		RETURN @HT
END

--tong thu chi thong ke su co
CREATE FUNCTION tongthuchisc(@NBD DATE, @NKT DATE)
RETURNS NVARCHAR(50)	
AS
	BEGIN
		DECLARE @HT MONEY
		SET @HT=(SELECT SUM(THU_CHI) FROM BIENBANSUCO,CTBBSC WHERE BIENBANSUCO.MABB=CTBBSC.MABB and BIENBANSUCO.NGAYLAPBB BETWEEN CONVERT(date,@NBD,111) AND CONVERT(date,@NKT,111))
		RETURN @HT
END

--tong thu chi thong ke su co
CREATE FUNCTION tongthuchicttksc(@MSC NVARCHAR(50),@NBD DATE, @NKT DATE)
RETURNS NVARCHAR(50)	
AS
	BEGIN
		DECLARE @HT MONEY
		SET @HT=(SELECT SUM(THU_CHI) FROM BIENBANSUCO,CTBBSC WHERE BIENBANSUCO.MABB=CTBBSC.MABB and CTBBSC.MASC=@MSC and BIENBANSUCO.NGAYLAPBB BETWEEN CONVERT(date,@NBD,111) AND CONVERT(date,@NKT,111))
		RETURN @HT
END
--tong so su co thong ke su co
CREATE FUNCTION TONGSOSC(@MSC NVARCHAR(50),@NBD DATE, @NKT DATE)
RETURNS NVARCHAR(50)
AS
	BEGIN
		DECLARE @HT INT
		SET @HT=(SELECT COUNT(*) FROM BIENBANSUCO,CTBBSC WHERE BIENBANSUCO.MABB=CTBBSC.MABB and CTBBSC.MASC=@MSC and BIENBANSUCO.NGAYLAPBB BETWEEN CONVERT(date,@NBD,111) AND CONVERT(date,@NKT,111))
		RETURN @HT
END

--tong so su co thong ke su co
CREATE FUNCTION TONGSOSC_frmtksc(@NBD DATE, @NKT DATE)
RETURNS NVARCHAR(50)
AS
	BEGIN
		DECLARE @HT INT
		SET @HT=(SELECT COUNT(*) FROM BIENBANSUCO,CTBBSC WHERE BIENBANSUCO.MABB=CTBBSC.MABB and BIENBANSUCO.NGAYLAPBB BETWEEN CONVERT(date,@NBD,111) AND CONVERT(date,@NKT,111))
		RETURN @HT
END

--tong doanh thu cuoi nam
CREATE FUNCTION rongthucuoinam(@NBD DATE, @NKT DATE)
RETURNS NVARCHAR(50)
AS
	BEGIN
		DECLARE @HT MONEY
		DECLARE @BAN MONEY
		SET @BAN=(SELECT SUM(TONGTIEN) FROM HOADONBAN WHERE HOADONBAN.NGAYLAP BETWEEN CONVERT(date,@NBD,111) AND CONVERT(date,@NKT,111))
		DECLARE @NHAP MONEY
		SET @NHAP=(SELECT SUM(TONGTIENNHAP) FROM PHIEUNHAP WHERE PHIEUNHAP.NGAYNHAP BETWEEN CONVERT(date,@NBD,111) AND CONVERT(date,@NKT,111))
		DECLARE @SC MONEY
		SET @SC=(SELECT SUM(THU_CHI) FROM BIENBANSUCO,CTBBSC WHERE BIENBANSUCO.MABB=CTBBSC.MABB and BIENBANSUCO.NGAYLAPBB BETWEEN CONVERT(date,@NBD,111) AND CONVERT(date,@NKT,111))
		DECLARE @LG MONEY
		SET @LG=(SELECT SUM(THUCLANH) FROM NHANVIEN)
		SET @HT=(SELECT SUM((@BAN+@SC)-(@NHAP+@LG)))
		RETURN @HT
END
----------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------
---IN THÔNG TIN BIEN BẢN SỰ CỐ
CREATE FUNCTION XEMTT_BBSC(@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM BIENBANSUCO WHERE BIENBANSUCO.MABB LIKE '%'+@TLG+'%')
GO
----in thông tin ct biên bản sự cố
CREATE FUNCTION XEMTT_CTBBSC(@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM CTBBSC WHERE CTBBSC.MABB LIKE '%'+@TLG+'%')
GO

---in danh sách hóa đơn
CREATE FUNCTION XEMTT_HoaDonBan(@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM HOADONBAN WHERE HOADONBAN.MAHD LIKE '%'+@TLG+'%')
GO
----in thông tin chi tiết hóa đơn bán
CREATE FUNCTION XEMTT_CTHoaDonBan(@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM CHITIETHOADONBAN WHERE CHITIETHOADONBAN.MASP LIKE '%'+@TLG+'%')
GO

----in thông tin khuyến mãi

CREATE FUNCTION XEMTT_KHUYENMAI(@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM KHUYENMAI WHERE KHUYENMAI.MAKM LIKE '%'+@TLG+'%')
GO

----in thông tin CHI TIẾT KHUYẾN MÃI

CREATE FUNCTION XEMTT_CTKHUYENMAI(@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM CT_KHUYENMAI WHERE CT_KHUYENMAI.MAKM LIKE '%'+@TLG+'%')
GO

--------------------------------------------------
---xem thông tin đơn đặ thàng khách hàng
CREATE FUNCTION XEMTT_DDHKH (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM DONDATHANGKH WHERE DONDATHANGKH.MADH LIKE '%'+@TLG+'%')
GO
---xem thông tin ct đơn đặt hàng khách hàng
CREATE FUNCTION XEMTT_CTDDHKH (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM CHITIETDDHKHACHHANG WHERE CHITIETDDHKHACHHANG.MADH LIKE '%'+@TLG+'%')
GO
--*xem thông tin giao hàng
CREATE FUNCTION XEMTT_GIAOHANG (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM GIAOHANG WHERE GIAOHANG.MADH LIKE '%'+@TLG+'%')
GO

----XEM THÔNG TIN SẢN PHẨM
create FUNCTION XEMTT_SANPHAM (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM SANPHAM WHERE SANPHAM.MASP LIKE '%'+@TLG+'%' or SANPHAM.TENSP LIKE '%'+@TLG+'%')
GO
---XEM THÔNG TIN KHO
CREATE FUNCTION XEMTT_kHO (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM KHO WHERE KHO.MASP LIKE '%'+@TLG+'%')
GO
---XEM THÔNG TIN SIZE GIÀY
CREATE FUNCTION XEMTT_SIZE (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM SIZEGIAY WHERE SIZEGIAY.MASP LIKE '%'+@TLG+'%')
GO

--XEM THÔNG TIN NHÀ CUNG CẤP
CREATE FUNCTION XEMTT_TTNCC (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM NHACC WHERE NHACC.MANCC LIKE '%'+@TLG+'%')
GO

---xem thông tin phiếu nhập
CREATE FUNCTION XEMTT_PHIEUNHAP(@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM PHIEUNHAP WHERE PHIEUNHAP.MAPN LIKE '%'+@TLG+'%')
GO
---xem thông tin chi tiết phiếu nhập
CREATE FUNCTION XEMTT_CTPHIEUNHAP (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM CHITIETPHIEUNHAP WHERE CHITIETPHIEUNHAP.MAPN LIKE '%'+@TLG+'%')
GO
---xem thông tin khách hàng

CREATE FUNCTION XEMTT_TTKHACHHANG (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM KHACHHANG WHERE KHACHHANG.SDTKHACHHANG LIKE '%'+@TLG+'%')
GO
---xem thông tin nhân viên
CREATE FUNCTION XEMTT_TTNHANVIEN (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM NHANVIEN WHERE NHANVIEN.MANV LIKE '%'+@TLG+'%'OR NHANVIEN.TENNV LIKE '%'+@TLG+'%')
GO
---xem thông tin tài khoản nv

CREATE FUNCTION XEMTT_TTTAIKHOANNV (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM QUANLYND WHERE QUANLYND.TENDN LIKE '%'+@TLG+'%')
GO
---xem thông tin chức vụ
create FUNCTION XEMTT_TTCHUCVU (@TLG NVARCHAR(10))
RETURNS TABLE
AS
	RETURN (SELECT * FROM CHUCVU WHERE CHUCVU.MACHUCVU LIKE '%'+@TLG+'%'OR CHUCVU.TENCV LIKE '%'+@TLG+'%')
GO

-----------Nhập Liệu-------------------------------------------------------------------------------
INSERT INTO DANHMUCSP
VALUES ('DM01',N'Giày Nam'),
		('DM02',N'Giày Nữ')
		-------------------
INSERT INTO LOAIGIAY
values ('L01',N'Giày thể thao'),
	('L02',N'giày cao gót'),
	('L03',N'Giày boot')
-----------------------------------------
insert into NHACC
values (N'NCC1 ', N'Công ty CP quốc Tế Vip', '37932702', N'info@evashoes.com.vn', N'26 Nguyễn Phong Sắc, Cầu Giấy, Hà Nội'),
		(N'NCC2', N'Công ty Giày Thái Dương', '37520198', N'Giaytd@gmail.com    ', N'3 Tân Thới nhất, Hóc Môn, tp Hồ CHí Minh'),
		(N'NCC3  ', N'Công Ty Bitit', '3813786', N'bitit@bitit.com.vn  ', N'1 Phạm Văn Thuận, Biên Hòa, Đồng Nai')
----------------------------------------
insert into SANPHAM
values ('SP1',N'Adidas NDM','DM01',N'Xanh',N'Vải','1000000','5',N'Còn hàng','L01','NCC1'),
		('SP2',N'sneakers','DM01',N'Xanh',N'Vải','1000000','5',N'Còn hàng','L01','NCC2')
insert into SANPHAM
values('SP3',N'Vans','DM01',N'Xanh',N'Vải','2000000','5',N'Còn hàng','L01','NCC2')
--------------------------------------------
insert into KHO
values ('SP1','DM01','L01','50',N'Còn hàng'),
		('SP2','DM02','L02','40',N'Hết hàng')
-----------------------------------------------
INSERT INTO SIZEGIAY
VALUES ('SP1','37','20'),
		('SP1','38','10'),
		('SP2','39','30')
-------------------------------------------
INSERT INTO CHUCVU
VALUES ('CV1',N'Nhân viên bán hàng','6000000'),
		('CV2',N'Nhân viên kho','7000000'),
		('CV3',N'Quản Lý','10000000')
INSERT INTO CHUCVU
VALUES ('CV4',N'Nhân viên giao hàng','5000000'),
		('CV5',N'Nhân viên nhân sự','7000000'),
		('CV6',N'Nhân viên thống kê','8000000'),
		('CV7',N'Giám đốc','9000000')
----------------------------------------------------------------
Set dateformat dmy
INSERT INTO NHANVIEN
VALUES ('NV01',N'Nguyễn Quang Vinh',N'Nam','212142899','0378298647',N'140 Lê trọng tấn','CV1',N'Đang làm việc','2/2/2017',NULL,'1000000','300000','6700000')
Set dateformat dmy
INSERT INTO NHANVIEN
VALUES ('NV02',N'Nguyễn Quang Vinh',N'Nam','212125499','0378298647',N'140 Lê trọng tấn','CV1',N'Đang làm việc','2/2/2017','NV01','1000000','300000','6700000')
Set dateformat dmy
INSERT INTO NHANVIEN
VALUES ('NV03',N'Nguyễn Thị Tuyết Hoa',N'Nữ','212832144','0965894875',N'64 Nguyễn Đỗ cung','CV2',N'Đang làm việc','2/2/2017','NV02','1000000','300000','6700000')
Set dateformat dmy
INSERT INTO NHANVIEN
VALUES ('NV04',N'Hông Nhung',N'Nữ','324567894','034895754',N'11 Dương Đức Hiền','CV3',N'Đang làm việc','2/2/2017','NV01','1000000','300000','6700000')
Set dateformat dmy
INSERT INTO NHANVIEN
VALUES ('NV05',N'Nguyễn Thị Thu Sương',N'Nữ','142154684','031589742',N'63 Phạm Ngọc Thảo','CV4',N'Đang làm việc','2/12/2019','NV03','1000000','100000','6900000')
Set dateformat dmy
INSERT INTO NHANVIEN
VALUES ('NV06',N'Thanh Thu',N'Nu','121458794','031589742',N'63 Lê TRọng Tấn','CV5',N'Đang làm việc','30/12/2019','NV05','2000000','10000','7900000')
Set dateformat dmy
INSERT INTO NHANVIEN
VALUES ('NV07',N'Thanh Lợi',N'Nam','121458526','031589742',N'63 Tân Quý','CV6',N'Đang làm việc','30/12/2019','NV05','2000000','10000','7900000')
Set dateformat dmy
INSERT INTO NHANVIEN
VALUES ('NV08',N'Xuân Phương',N'Nam','154785479','0125497820',N'63 Trường Chinh','CV7',N'Đang làm việc','3/12/2019','NV06','2000000','10000','7900000')
--------------------------------------------------------------------------------------------------
insert into KHUYENMAI
VALUES ('KM1',N'Khuyến mãi lễ 2.9','0.5',1),
		('KM2',N'Khuyến mãi tết','0.3',0)
---------------------------------------------------------------------------
SET DATEFORMAT DMY
insert into CT_KHUYENMAI
values ('KM1','SP1','1/9/2019','4/9/2019'),
		('KM2','SP2','5/12/2018','15/12/2018')
---------------------------------------------------------
insert into KHACHHANG
values ('KH01',N'Thùy Ly','0231569874','2 Sơn Kỳ'),
		('KH02',N'Tuyết Nhi','0315874985','2 Tân Quý'),
		('KH03',N'Hà Nam','0231569874','6 Tây Thạnh')
------------------------------------------------------------------------
SET DATEFORMAT DMY
insert into HOADONBAN
values ('HD1','26/9/2019','NV01','0','KH01',null,'10')
		
SET DATEFORMAT DMY
insert into HOADONBAN
values('HD2','26/9/2019','NV02','0','KH02',null,'12')
SET DATEFORMAT DMY
insert into HOADONBAN
values ('HD3','26/9/2019','NV02','0','KH01',null,'20')
----------------------------------------------------------
INSERT INTO PHIEUBAOHANH
VALUES ('BH01','NV01','KH01','SP1','3/10/2019'),
		('BH02','NV02','KH02','SP2','3/10/2019'),
		('BH03','NV01','KH01','SP3','4/10/2019')
-----------------------------------------------------------------
------------
INSERT INTO CHITIETHOADONBAN
VALUES ('CT1','HD1','SP1','BH01','KM1','1','1000000')
INSERT INTO CHITIETHOADONBAN
VALUES ('CT2','HD2','SP2','BH02','KM1','1','1000000')
INSERT INTO CHITIETHOADONBAN
VALUES ('CT3','HD3','SP3','BH03','KM1','1','2000000')
---------------------------
-----------
insert into QLNHOMND
values ('N01',N'Bán hàng',NULL),
		('N02',N'Nhập hàng',NULL),
		('N03',N'Sản phẩm',NULL),
		('N04',N'quản lý Sự cố',NULL),
		('N05',N'quản lý người dùng',NULL),
		('N06',N'Quản lý thống kê',NULL)
insert into QLNHOMND
values('N07',N'Giám đốc ',NULL),
		('N08',N'Quản lý',NULL)
--------------

INSERT INTO QUANLYND
VALUES ('NV01','123456789','true'),
('NV02','123456789','false'),
('NV03','123456789','false'),
('NV04','123456789','false'),
('NV05','123456789','false'),
('NV06','123456789','false'),
('NV07','123456789','false'),
('NV08','123456789','false')
insert into QLNDNHOMND
values ('NV01','N01',NULL),
		('NV02','N03',NULL),
		('NV03','N02',NULL),
		('NV04','N07',NULL),
		('NV05','N01',NULL),
		('NV06','N05',NULL),
		('NV07','N06',NULL),
		('NV08','N07',NULL)
---------------
insert into DMMANHINH
values ('MH1',N'Bán Hàng'),
		('MH2',N'Nhập phiếu hàng'),
		('MH3',N'Sản Phẩm'),
		('MH4',N'Sự cố'),
		('MH5',N'Người dùng'),
		('MH6',N'Quyền'),
		('MH7',N'Thống kê')
------------------------------------
----------
insert into QLPHANQUYEN
values ('N01','MH1','true'),
		('N02','MH2','true'),
		('N03','MH3','true'),
		('N04','MH4','true'),
		('N05','MH5','true'),
		('N06','MH7','true'),
		('N07','MH1','true'),
		('N07','MH2','true'),
		('N07','MH3','true'),
		('N07','MH4','true'),
		('N07','MH5','true'),
		('N07','MH6','true'),
		('N07','MH7','true')
------------------------------
SET DATEFORMAT DMY
insert into PHIEUNHAP
values ('PN1','NV02','NCC1','26/09/2019','0')
SET DATEFORMAT DMY
insert into PHIEUNHAP
values ('PN2','NV02','NCC2','26/09/2019','0')
---------------------------------------------

insert into CHITIETPHIEUNHAP
values ('CTPN1','PN1','SP1','20','200000')

insert into CHITIETPHIEUNHAP
values ('CTPN2','PN1','SP2','10','100000')
insert into CHITIETPHIEUNHAP
values ('CTPN3','PN2','SP1','20','200000')

-------------------------------------------
set dateformat dmy
insert into PHIEUDATHANGNCC
values ('DH1','NCC1','NV01','26/9/2019','0',N'chưa Giao','50000')
set dateformat dmy
insert into PHIEUDATHANGNCC
values ('DH2','NCC2','NV03','26/9/2019','0',N'chưa Giao','50000')
--------------------------------------------------------------------
------------------

insert into CTPHIEUDATHANGNCC
values ('DH1','SP1','5','200000')
insert into CTPHIEUDATHANGNCC
values ('DH2','SP2','10','300000')
------------------
------------------------------------------------------
set dateformat dmy
insert into DONDATHANGKH
values ('DH1','KH01','3','26/9/2019','0')
set dateformat dmy
insert into DONDATHANGKH
values ('DH2','KH02','2','26/9/2019','0')
------------------------------------------------------

insert into CHITIETDDHKHACHHANG
values ('DH1','SP1','2','1000000'),
insert into CHITIETDDHKHACHHANG
values ('DH1','SP2','1','2000000')

-----------------------------------------------------
set dateformat dmy
insert into GIAOHANG
values ('DH1','HD1','NV05','29/9/2019',N'Chưa giao')
set dateformat dmy
insert into GIAOHANG
values ('DH2','HD2','NV05','29/9/2019',N'Chưa giao')
------------------------------------------------------
insert into DMSUCO
values ('SC1',N'bung keo','30000'),
		('SC2',N'Nhầm size','30000'),
		('SC3',N'Nhầm màu','30000')
------------------------------------------------------
set dateformat dmy
insert into BIENBANSUCO
values ('BB1','NV01',NULL,'26/9/2019')
set dateformat dmy
insert into BIENBANSUCO
values ('BB2','NV02',NULL,'26/9/2019')

---------------------------------------------------
insert into CTBBSC
values ('BB1','SC1','30000'),
		('BB2','SC1','30000')
		----------------------------------------
insert into DMTK
values ('DM1',N'Thống kê sự cố'),
		('DM2',N'Thống kê doanh thu'),
		('DM3',N'Thống kê quý')
---------------------------------------------------
insert into THONGKE_SC
values('TKSC1','NV07','DM1','26/9/2019','1','60000'),
		('TKSC2','NV07','DM1','26/9/2019','1','30000')
-----------------------------------------------

insert into CTTKSC
values ('TKSC1','BB1','30000'),
		('TKSC2','BB2','30000')
		---------------------------------------------------
set dateformat dmy
insert into THONGKE_DS
values ('DS1','NV05','DM2','26/9/2019','2','5000000'),
		('DS2','NV05','DM2','26/9/2019','2','5000000')
-----------------------------------------------------
insert into CTTKDS
values ('DS1','SP1','L01','250000'),
		('DS2','SP2','L01','250000')
---------------------------------------------------
set dateformat dmy
insert into THONGKE_CUOINAM
values ('TKCN1','NV05','DM3','26/9/2019','50000000'),
		('TKCN2','NV05','DM3','26/9/2019','100000000')

alter table CHITIETHOADONBAN
ADD SOSIZE INT

SELECT        CHITIETHOADONBAN.MACTHDB, CHITIETHOADONBAN.MAHD, CHITIETHOADONBAN.MASP, CHITIETHOADONBAN.MABH, CHITIETHOADONBAN.SOLUONGBAN, CHITIETHOADONBAN.DONGIABAN, CHITIETHOADONBAN.SOSIZE, 
                         SANPHAM.MAU, PHIEUBAOHANH.NGAYHETHANDOITRA
FROM           CHITIETHOADONBAN, SANPHAM, PHIEUBAOHANH
WHERE CHITIETHOADONBAN.MASP=SANPHAM.MASP AND CHITIETHOADONBAN.MABH=PHIEUBAOHANH.MABH

select * from CTTKDS